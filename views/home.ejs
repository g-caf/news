<%- include('partials/head', { title: 'Latest Stories' }) %>
<body class="home-page">
    <%- include('partials/header') %>
    
    <main class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>Latest Stories</h1>
                <p>Stay informed with the latest articles from your favorite publications</p>
            </div>
            
            <div class="filter-section">
                <h3>Filter by topic:</h3>
                <div class="publication-filters">
                    <a href="/" class="filter-btn <%= !selectedTag && !selectedCategory && !selectedPublication ? 'active' : '' %>">All</a>
                    <% topicTags.forEach(tag => { %>
                        <a href="/?tag=<%= encodeURIComponent(tag) %>" 
                           class="filter-btn <%= selectedTag === tag ? 'active' : '' %>">
                            <%= tag %>
                        </a>
                    <% }) %>
                </div>
            </div>

            <div class="filter-section">
                <h3>Filter by publication type:</h3>
                <div class="publication-filters">
                    <% categories.forEach(category => { %>
                        <a href="/?category=<%= encodeURIComponent(category) %>" 
                           class="filter-btn <%= selectedCategory === category ? 'active' : '' %>">
                            <%= category %>
                        </a>
                    <% }) %>
                </div>
            </div>
            
            <div class="filter-section">
                <h3>Filter by publication:</h3>
                <div class="publication-filters">
                    <% publications.forEach(pub => { %>
                        <a href="/?publication=<%= pub.id %>" 
                           class="filter-btn <%= selectedPublication == pub.id ? 'active' : '' %>">
                            <%= pub.name %>
                        </a>
                    <% }) %>
                </div>
            </div>
            
            <div class="articles-grid">
                <% if (articles.length === 0) { %>
                    <div class="no-articles">
                        <h3>No articles found</h3>
                        <p>Try adjusting your filters or check back later for new content.</p>
                    </div>
                <% } else { %>
                    <% articles.forEach(article => { %>
                        <article class="article-card <%= article.image_url ? '' : 'no-image' %>" onclick="window.location='/articles/<%= article.id %>'">
                            <% if (article.image_url) { %>
                                <img src="<%= article.image_url %>" alt="<%= article.title %>" class="article-image" loading="lazy" onerror="this.parentElement.classList.add('no-image'); this.style.display='none';">
                            <% } %>
                            <div class="article-overlay">
                                <div class="article-meta">
                                    <span class="publication-name"><%= article.publication_name %></span>
                                    <span class="publish-date"><%= article.published_date ? new Date(article.published_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : 'Recent' %></span>
                                </div>
                                <h2 class="article-title">
                                    <a href="/articles/<%= article.id %>"><%= article.title %></a>
                                </h2>
                            </div>
                        </article>
                    <% }) %>
                <% } %>
            </div>
            
            <% if (articles.length >= 20) { %>
                <div class="pagination">
                    <% 
                    const params = new URLSearchParams();
                    params.set('offset', (offset || 0) + 20);
                    if (selectedPublication) params.set('publication', selectedPublication);
                    if (selectedCategory) params.set('category', selectedCategory);
                    if (selectedTag) params.set('tag', selectedTag);
                    %>
                    <a href="?<%= params.toString() %>" class="load-more-btn">Load More Stories</a>
                </div>
            <% } %>
        </div>
    </main>
    
    <%- include('partials/footer') %>
